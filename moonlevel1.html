<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Moon Cylindrical Habitat — Level 1 (Interactive)</title>
  <style>
    :root{--bg:#0b1020;--card:#0f1724;--accent:#60a5fa;--muted:#94a3b8;--good:#10b981;--bad:#ef4444}
    html,body{height:100%;margin:0;font-family:Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;color:#e6eef8;background:linear-gradient(180deg,#030416 0%, #07102a 60%);}
    .app{display:grid;grid-template-columns:320px 1fr 340px;gap:18px;padding:20px;height:100vh;box-sizing:border-box}

    /* LEFT SIDEBAR */
    .sidebar{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));padding:16px;border-radius:12px;box-shadow:0 6px 18px rgba(2,6,23,0.6);overflow:auto}
    .sidebar h2{margin:0 0 12px 0;font-size:18px}
    .module{background:rgba(255,255,255,0.03);padding:10px;border-radius:8px;margin-bottom:10px;display:flex;align-items:center;gap:10px;cursor:grab;border:1px dashed rgba(255,255,255,0.03)}
    .module:active{cursor:grabbing}
    .module .tag{font-size:13px;padding:6px 8px;border-radius:6px;background:rgba(255,255,255,0.03)}
    .muted{color:var(--muted);font-size:13px}

    /* CENTER: HABITAT */
    .stage{display:flex;flex-direction:column;align-items:center;justify-content:center;gap:12px}
    .viewport{width:760px;height:560px;background:radial-gradient(circle at 20% 15%, rgba(96,165,250,0.04), transparent 10%), linear-gradient(180deg,#07132b,#021220);border-radius:14px;padding:18px;box-shadow:0 12px 30px rgba(2,6,23,0.6);position:relative;display:flex;align-items:center;justify-content:center}

    .hud{position:absolute;left:18px;top:18px;color:var(--muted);font-size:13px}
    .hud .rules{max-width:300px}

    /* RIGHT: INFO PANEL */
    .info{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));padding:16px;border-radius:12px;box-shadow:0 6px 18px rgba(2,6,23,0.6);display:flex;flex-direction:column;gap:10px}
    .info h3{margin:0}
    .log{background:rgba(0,0,0,0.2);padding:10px;border-radius:8px;height:220px;overflow:auto;color:#d7e7ff}
    .status{display:flex;gap:10px;flex-wrap:wrap}
    .pill{padding:8px 10px;border-radius:999px;background:rgba(255,255,255,0.03);font-size:13px}

    /* dropzone visuals */
    .dropzone{stroke:rgba(255,255,255,0.06);fill:transparent;cursor:pointer}
    .dropzone.hover{stroke:rgba(96,165,250,0.9);fill:rgba(96,165,250,0.04)}

    .placed{font-size:13px;margin-top:6px;color:#dbeafe}
    .module.small{font-size:13px;padding:6px}

    .result{padding:10px;border-radius:8px}
    .good{background:linear-gradient(90deg, rgba(16,185,129,0.12), rgba(16,185,129,0.04));border:1px solid rgba(16,185,129,0.12);color:var(--good)}
    .bad{background:linear-gradient(90deg, rgba(239,68,68,0.06), rgba(239,68,68,0.02));border:1px solid rgba(239,68,68,0.06);color:var(--bad)}

    .btn{padding:8px 12px;border-radius:8px;background:var(--accent);border:none;color:#041124;font-weight:600;cursor:pointer}
    .btn.ghost{background:transparent;border:1px solid rgba(255,255,255,0.04);color:#cfe8ff}

    footer{position:absolute;right:20px;bottom:20px;color:var(--muted);font-size:12px}

    @media (max-width:1100px){.app{grid-template-columns:240px 1fr;grid-auto-rows:1fr} .info{display:none}}
  </style>
</head>
<body>
  <div class="app">
    <aside class="sidebar">
      <h2>Modules — drag to place</h2>
      <div id="modules"></div>
      <div style="margin-top:12px" class="muted">Tip: drag a module into any ring of the cylinder. Drop rules will notify you if placement is incorrect.</div>
    </aside>

    <main class="stage">
      <div class="viewport">
        <div class="hud">
          <div><strong>Moon Cylindrical Habitat — Level 1</strong></div>
          <div class="rules muted">Structure: Pressurized cylinder, buried under regolith. Place modules into rings: Core → Crew → Outer.</div>
        </div>

        <!-- Cylinder representation -->
        <svg id="habitatSvg" width="620" height="520" viewBox="0 0 620 520" xmlns="http://www.w3.org/2000/svg">
          <!-- Outer hull (capsule/cylinder) -->
          <rect id="outerZone" class="dropzone" x="60" y="60" width="500" height="400" rx="120" ry="120" stroke-width="6"/>
          <!-- Crew ring -->
          <rect id="crewZone" class="dropzone" x="160" y="160" width="300" height="200" rx="60" ry="60" stroke-width="6"/>
          <!-- Core zone -->
          <rect id="coreZone" class="dropzone" x="270" y="220" width="80" height="80" rx="20" ry="20" stroke-width="6"/>

          <!-- labels -->
          <text x="310" y="40" font-size="18" text-anchor="middle" fill="#cfe8ff">Cylindrical Cross-section</text>
          <text x="310" y="70" font-size="13" text-anchor="middle" fill="#cfe8ff">Drop modules into rings</text>
        </svg>
      </div>

      <div style="width:760px;display:flex;justify-content:space-between;align-items:center">
        <div class="status">
          <div class="pill">Goal: Place required modules to stabilize habitat</div>
          <div class="pill">Constraint: Avoid forbidden neighbors</div>
        </div>

        <div style="display:flex;gap:8px">
          <button class="btn" id="checkBtn">Check Level</button>
          <button class="btn ghost" id="resetBtn">Reset</button>
        </div>
      </div>
    </main>

    <aside class="info">
      <h3>Placement Log</h3>
      <div class="log" id="log"></div>

      <h3>Module Status</h3>
      <div id="placedList" class="placed"></div>

      <h3>Level Result</h3>
      <div id="resultBox" class="result">Not checked yet.</div>

      <div style="display:flex;gap:8px;margin-top:8px">
        <button class="btn ghost" id="hintBtn">Show Placement Hints</button>
        <button class="btn" id="completionTextBtn">Show Completion Text</button>
      </div>
    </aside>
  </div>

  <footer>Interactive level simulation • Drag & drop • Rules inspired by real mission constraints</footer>

  <script>
    const MODULES = [
      {id:'waste', name:'Waste Management', allowed:['outer'], forbiddenNear:['food','sleep','med'] ,desc:'Near life support but separated from food & medical.'},
      {id:'thermal', name:'Thermal Control', allowed:['outer'], forbiddenNear:[],desc:'Outer hull with power + life support.'},
      {id:'life', name:'Life Support', allowed:['core'], forbiddenNear:[],desc:'Central hub, linked to waste + thermal + power.'},
      {id:'comms', name:'Communications', allowed:['core'], forbiddenNear:[],desc:'Connect to power & external antenna.'},
      {id:'power', name:'Power', allowed:['core'], forbiddenNear:[],desc:'Central hub; solar outside, batteries inside.'},
      {id:'stow', name:'Stowage', allowed:['core','crew'], forbiddenNear:[],desc:'Near central hub but not blocking exits.'},
      {id:'food', name:'Food Storage & Prep', allowed:['crew'], forbiddenNear:['waste'],desc:'Near stowage & life support, far from waste.'},
      {id:'med', name:'Medical Care', allowed:['crew'], forbiddenNear:['waste','exercise'],desc:'Near sleep + central hub, isolated from waste.'},
      {id:'sleep', name:'Sleep Quarters', allowed:['crew'], forbiddenNear:['exercise','power','waste'],desc:'Quiet zone, away from exercise + power + waste.'},
      {id:'ex', name:'Exercise', allowed:['crew','core'], forbiddenNear:['sleep','med'],desc:'Central, near power, away from sleep.'}
    ];

    const REQUIRED = ['life','power','thermal','waste','food','sleep','med','comms','stow'];
    const placements = {};
    const zoneElements = {
      outer: document.getElementById('outerZone'),
      crew: document.getElementById('crewZone'),
      core: document.getElementById('coreZone')
    };

    const modulesContainer = document.getElementById('modules');
    const logEl = document.getElementById('log');
    const placedList = document.getElementById('placedList');
    const resultBox = document.getElementById('resultBox');

    MODULES.forEach(m=>{
      const div = document.createElement('div');
      div.className='module'; div.draggable=true; div.id='mod-'+m.id;
      div.innerHTML=`<div style="width:36px;height:36px;border-radius:8px;background:rgba(255,255,255,0.02);display:flex;align-items:center;justify-content:center;font-weight:700">${m.name.split(' ').map(w=>w[0]).slice(0,2).join('')}</div>
      <div style="flex:1"><div style="font-weight:700">${m.name}</div><div class="muted" style="font-size:12px">${m.desc}</div></div>`;
      div.addEventListener('dragstart', e=>{ e.dataTransfer.setData('text/plain', m.id); e.dataTransfer.effectAllowed='move'; });
      modulesContainer.appendChild(div);
    });

    Object.entries(zoneElements).forEach(([zoneName, el])=>{
      el.addEventListener('dragover', evt=>{ evt.preventDefault(); el.classList.add('hover'); });
      el.addEventListener('dragleave', evt=>{ el.classList.remove('hover'); });
      el.addEventListener('drop', evt=>{
        evt.preventDefault(); el.classList.remove('hover');
        const moduleId = evt.dataTransfer.getData('text/plain');
        if(!moduleId) return; placeModule(moduleId, zoneName);
      });
    });

    function log(msg,type='info'){ const p=document.createElement('div'); p.textContent='· '+msg; p.style.marginBottom='6px'; if(type==='bad')p.style.color='#ffb4b4'; logEl.prepend(p);}
    function updatePlacedList(){ placedList.innerHTML=''; for(const [mid,zone] of Object.entries(placements)){ const mod=MODULES.find(m=>m.id===mid); const d=document.createElement('div'); d.className='module small'; d.textContent=`${mod.name} — ${zone.toUpperCase()}`; placedList.appendChild(d);} if(Object.keys(placements).length===0) placedList.textContent='No modules placed yet.'; }

    function placeModule(modId, zone){
      const mod=MODULES.find(m=>m.id===modId); if(!mod)return;
      if(!mod.allowed.includes(zone)){ log(`${mod.name} cannot be placed in ${zone.toUpperCase()}! Expected: ${mod.allowed.join(', ').toUpperCase()}.`,'bad'); resultBox.className='result bad'; resultBox.textContent=`${mod.name} wrongly placed in ${zone}.`; }
      placements[modId]=zone; log(`${mod.name} placed in ${zone.toUpperCase()}.`); renderPlacements(); updatePlacedList();
    }

    function renderPlacements(){
      const svg=document.getElementById('habitatSvg');
      [...svg.querySelectorAll('[data-placed]')].forEach(n=>n.remove());
      const coords={core:{x:310,y:260,spacing:18},crew:{x:310,y:260,spacing:50},outer:{x:310,y:260,spacing:90}};
      const counts={core:0,crew:0,outer:0};
      for(const [mid,zone] of Object.entries(placements)){
        counts[zone]++; const angle=(counts[zone]*50)%360; const rad=(angle*Math.PI/180); const r=coords[zone].spacing;
        const x=coords[zone].x+Math.cos(rad)*r; const y=coords[zone].y+Math.sin(rad)*r;
        const g=document.createElementNS('http://www.w3.org/2000/svg','g'); g.setAttribute('transform',`translate(${x-18},${y-18})`); g.setAttribute('data-placed',mid);
        const circle=document.createElementNS('http://www.w3.org/2000/svg','rect'); circle.setAttribute('rx',8); circle.setAttribute('ry',8); circle.setAttribute('width',36); circle.setAttribute('height',36); circle.setAttribute('fill','rgba(255,255,255,0.03)'); circle.setAttribute('stroke','rgba(255,255,255,0.06)');
        const text=document.createElementNS('http://www.w3.org/2000/svg','text'); text.setAttribute('x',18); text.setAttribute('y',22); text.setAttribute('text-anchor','middle'); text.setAttribute('font-size',12); text.setAttribute('fill','#dbeafe'); text.textContent=MODULES.find(m=>m.id===mid).name.split(' ').map(w=>w[0]).slice(0,2).join('');
        g.appendChild(circle); g.appendChild(text); svg.appendChild(g);
        g.style.cursor='pointer'; g.addEventListener('click',()=>{ removePlacement(mid); });
      }
    }

    function removePlacement(mid){ delete placements[mid]; log(`${MODULES.find(m=>m.id===mid).name} removed.`); renderPlacements(); updatePlacedList(); }

    document.getElementById('resetBtn').addEventListener('click',()=>{ for(const k of Object.keys(placements)) delete placements[k]; renderPlacements(); updatePlacedList(); log('Level reset.'); resultBox.className='result'; resultBox.textContent='Not checked yet.'; });

    document.getElementById('checkBtn').addEventListener('click',()=>{
      const check=evaluateLevel();
      if(check.ok){ resultBox.className='result good'; resultBox.innerHTML=`<strong>Habitat stabilized!</strong><div style="font-size:13px;margin-top:6px">All required modules present and mostly correctly placed. Astronauts can survive on Moon.</div>`; log('Level PASSED. Habitat stabilized.'); }
      else{ resultBox.className='result bad'; resultBox.innerHTML=`<strong>Level Failed</strong><div style="font-size:13px;margin-top:6px">${check.messages.join('<br>')}</div>`; log('Level FAILED. See violation messages.','bad'); }
    });

    document.getElementById('hintBtn').addEventListener('click',()=>{ const hints=MODULES.map(m=>`• ${m.name}: allowed in ${m.allowed.join(', ').toUpperCase()}.`).join('\n'); alert('Placement hints:\n\n'+hints); });

    document.getElementById('completionTextBtn').addEventListener('click',()=>{ alert(`Habitat stabilized! Correct placement ensures astronaut survival on the Moon.\n\n• Thermal Control keeps interior at ~22°C despite outside swings (-170°C to +120°C).\n• Life Support holds air at 21% O₂, 101 kPa pressure → safe breathing.\n• Power Systems provide continuous supply during 14-day lunar night via solar + batteries.\n• Waste Management prevents toxic gas buildup.\n• Food & Water Systems keep crew nourished for 30 days+.\n• Sleep Quarters protect circadian rhythm, maintaining crew health.\n• Exercise Zone prevents bone/muscle loss in 0.16 g gravity.\n• Communications keep contact with Earth, ensuring safety & morale.\n• Medical Bay provides emergency care in case of radiation, injuries, or dust exposure.`); });

    function evaluateLevel(){
      const messages=[]; let ok=true;
      const missing=REQUIRED.filter(r=>!placements[r]);
      if(missing.length>0){ ok=false; messages.push(`Missing modules: ${missing.map(m=>MODULES.find(x=>x.id===m).name).join(', ')}.`); }
      for(const [mid,zone] of Object.entries(placements)){ const mod=MODULES.find(m=>m.id===mid); if(!mod.allowed.includes(zone)){ ok=false; messages.push(`${mod.name} wrongly placed in ${zone.toUpperCase()} (allowed: ${mod.allowed.join(', ').toUpperCase()}).`); } }
      for(const m of MODULES){
        const placedZone=placements[m.id]; if(!placedZone) continue;
        for(const forbidden of m.forbiddenNear){
          const f=MODULES.find(x=>x.id===forbidden||x.id===forbidden.replace(/[^a-z]/g,'')); if(!f) continue;
          if(placements[f.id]){ if(placements[f.id]===placedZone){ ok=false; messages.push(`${m.name} should not be next to ${f.name} (both in ${placedZone.toUpperCase()}).`); } }
        }
      }
      if(!placements['life']||!placements['power']){ ok=false; messages.push('Life Support and Power must be present in the CORE to maintain atmosphere & systems.'); }
      return {ok,messages};
    }

    updatePlacedList(); renderPlacements(); log('Level loaded. Drag modules from the left into the cylinder rings. Click modules in the cylinder to remove them.');
  </script>
</body>
</html>
